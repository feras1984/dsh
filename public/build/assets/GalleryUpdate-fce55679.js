import{C as w,r as I,R as P,j as e,F as G,h as J,J as $,k as K,P as W}from"./app-29790f36.js";import{B as q}from"./BlockService-d89fc718.js";import{u as Q,C as X}from"./CustomSnackbar-8b824b07.js";import{b as Y,z as B,u as Z,t as _,F as ee}from"./ValidatedInput-9a95dfd3.js";import{V as te,B as ae}from"./BasicTranslation-9700c8b8.js";import{V as se}from"./ValidatedSwitch-38705ab7.js";import{C as H}from"./CustomButton-2e172291.js";import{D as z}from"./DeleteModal-c5972250.js";import{F as R}from"./FileService-c182dbca.js";import{I as T}from"./Icon-506d581c.js";import{B as j}from"./Box-dc1b2ccf.js";import{C as re}from"./CardMedia-951a62d1.js";import{A as oe}from"./Avatar-0b1d2476.js";import{I as ie}from"./Send-0fc77969.js";import{M as ne}from"./Menu-c88da5fb.js";import{M as U}from"./MenuItem-41c99c0a.js";import{L}from"./ListItemIcon-8a92a89f.js";import{L as O}from"./ListItemText-dcedb6c7.js";import{B as le}from"./Breadcrumbs-52539b4f.js";import{T as V}from"./Typography-60e63e0f.js";import{S as me}from"./Stack-50fc598a.js";import{D as ce}from"./Divider-e9dcf4ee.js";import"./generateUtilityClasses-3b53fbe1.js";import"./useSlot-1c16ee9b.js";import"./mergeSlotProps-22577cf6.js";import"./useForkRef-183980e9.js";import"./createSvgIcon-8661e813.js";import"./styled-656f2a25.js";import"./Paper-5af31515.js";import"./useTheme-faf97a90.js";import"./Portal-94800457.js";import"./Grow-f6f3127b.js";import"./utils-625883c1.js";import"./ButtonBase-c01dbedb.js";import"./useControlled-e50ce4b8.js";import"./Select-b09c160d.js";import"./useFormControl-f4825f12.js";import"./debounce-2f5b2bed.js";import"./GlobalStyles-02ba2dcb.js";import"./template-1eb4ecfb.js";import"./FormControlLabel-899115a7.js";import"./SwitchBase-9f915b53.js";import"./createSvgIcon-9394f5ec.js";import"./Button-600e10b2.js";import"./Modal-250b81f8.js";import"./Backdrop-b801c1f5.js";import"./Menu-941ce189.js";import"./LocalGroceryStore-c40220ea.js";import"./List-11b6a348.js";import"./ListContext-24df6b55.js";import"./dividerClasses-4ef49731.js";import"./listItemTextClasses-8402aad5.js";import"./listItemIconClasses-aca8eb28.js";import"./styled-8ec0501a.js";import"./createStyled-093efa3a.js";const de=g=>{const n=w.get(R),[o,u]=I.useState(!1);return I.useEffect(()=>{u(n.assertImage(g))},[g]),console.log(o),o},pe=({className:g="relative",classes:n="",image:o=null,imageChanged:u,imageDelete:m})=>{const[d,h]=I.useState(null),[p,f]=I.useState(""),i=w.get(R),v=I.useRef(null),[k,S]=P.useState(null),C=!!k,y=()=>{S(null)},c=x=>{S(x.currentTarget)},l=()=>{var x;(x=v.current)==null||x.click(),y()},A=de(d),E=x=>{var D,N,M,t,a,s;x&&x.target&&(i.assertSize((N=(D=x.target)==null?void 0:D.files)==null?void 0:N[0])?i.assertImage((t=(M=x.target)==null?void 0:M.files)==null?void 0:t[0])?(f(""),u((s=(a=x.target)==null?void 0:a.files)==null?void 0:s[0])):f("Please upload an image!"):f("Image Size must be less than 200KB!"))},F=()=>{m(),y()};return e.jsxs(j,{children:[e.jsx(re,{classes:n,component:"img",src:A&&d?URL.createObjectURL(d):o||i.DefaultImage,alt:"photo",className:g}),e.jsxs(j,{className:"absolute top-[16px] right-[16px] rounded-full",children:[e.jsx(oe,{sx:{bgcolor:"rgba(0,0,0,0.52)"},children:e.jsx(ie,{id:"basic-button","aria-controls":C?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":C?"true":void 0,onClick:c,sx:{color:"white"},children:e.jsx(T,{name:"vertical-dots"})})}),e.jsxs(ne,{id:"basic-menu",anchorEl:k,open:C,onClose:y,MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:[e.jsxs(U,{onClick:l,children:[e.jsx(L,{children:e.jsx(T,{name:"edit"})}),e.jsx(O,{children:"Update"})]}),e.jsxs(U,{onClick:F,children:[e.jsx(L,{children:e.jsx(T,{name:"delete"})}),e.jsx(O,{children:"Delete"})]})]})]}),e.jsx("input",{type:"file",id:"hidden-input",className:"hidden",ref:v,onChange:E}),p&&e.jsx(Y,{sx:{color:"error.main",marginLeft:"8px",marginRight:"8px",textWrap:"nowrap"},children:p})]})},ge=({imageChanged:g,text:n="Product"})=>{const o=w.get(R),u=I.useRef(null),m=()=>{var h;(h=u.current)==null||h.click()},d=h=>{var p,f,i,v;h&&h.target&&o.assertImage((f=(p=h.target)==null?void 0:p.files)==null?void 0:f[0])&&g((v=(i=h.target)==null?void 0:i.files)==null?void 0:v[0])};return e.jsxs(j,{children:[e.jsx(H,{task:"add",text:`${n} image`,onClick:m}),e.jsx("input",{type:"file",id:"hidden-input",className:"hidden",ref:u,onChange:d})]})},ue=({images:g,callbackImageUrl:n,addImage:o,updateImage:u,deleteImage:m,text:d="product"})=>{const[h,p]=I.useState(!1),[f,i]=I.useState(0),v=()=>{p(!1)},k=c=>{i(c),p(!0)},S=c=>{o(c)},C=(c,l)=>{u(c,l)},y=()=>{m(f),p(!1)};return e.jsxs(j,{children:[e.jsx(j,{className:"px-[16px]",children:e.jsx(ge,{text:d,imageChanged:c=>S(c)})}),e.jsx(j,{className:"flex flex-wrap items-start content-center justify-start p-[16px] gap-[16px]",children:g.map((c,l)=>e.jsx(j,{className:"w-[250px] relative",children:e.jsx(pe,{classes:{img:"bg-center bg-cover object-cover  h-[195px] rounded-lg border-2 border-state-500"},imageChanged:A=>C(A,c.id),imageDelete:()=>k(c.id),image:n(c.url)})},l))}),e.jsx(z,{open:h,onClose:v,message:"Are you sure you want to delete this image?",confirmDelete:y})]})},ft=({category:g,block:n})=>{w.get(G);const o=w.get(q),u=w.get(J),[m,d]=I.useState({...n}),[h,p]=I.useState(n.images.filter(t=>!t.isCover));$().props.settings.languages;const{snackbar:f,setSnackbar:i,handleClose:v}=Q(),[k,S]=I.useState(!1),C=()=>{S(!1)},y=()=>{S(!0)},c=B.object({isActive:B.boolean().default(!0),translations:B.record(B.string().length(2),B.object({name:B.string().min(3,{message:"Title should be at least 3 characters!"})}))}),l=Z({mode:"onBlur",reValidateMode:"onBlur",resolver:_(c),defaultValues:{isActive:m.isActive,image:m.images[0].url,translations:o.getTranslationsDetails(m.translations)}}),A=()=>{var s;const t=((s=m.images.find(r=>r.isCover))==null?void 0:s.id)||-1,a=new FormData;a.append("image",l.getValues("image")),a.append("imageId",String(t)),o.uploadImage(a,n.id).then(r=>{d(r.data),i(b=>({...b,open:!0,message:"Image has been updated!",severity:"success"}))}).catch(r=>{i(b=>({...b,open:!0,message:"Error Happened while uploading image!",severity:"error"}))})},E=()=>{S(!1),o.deleteBlock(n.id).then(t=>{i(a=>({...a,open:!0,message:"Block has been deleted!",severity:"success"})),W.get("/admin/website/get-block/"+n.category)}).catch(t=>{i(a=>({...a,open:!0,message:"Error Happened while deleting block!",severity:"error"}))})},F=t=>{const a=new FormData;a.append("isActive",String(t)),o.blockActivation(a,n.id).then(s=>{d(s.data),i(r=>({...r,open:!0,message:"Block status has been successfully updated!",severity:"success"}))}).catch(s=>{i(r=>({...r,open:!0,message:"Error Happened while updating block status!",severity:"error"}))})},x=()=>{const t=new FormData;t.append("isActive",String(l.getValues("isActive"))),t.append("translations",JSON.stringify(l.getValues("translations"))),t.append("blockId",String(n.id)),o.updateBlock(t,n.id).then(a=>{d(a.data),i(s=>({...s,open:!0,message:"The block has been updated",severity:"success"}))}).catch(a=>{i(s=>({...s,open:!0,message:"Error Happened while updating block",severity:"error"}))})},D=t=>{const a=new FormData;a.append("image",t),a.append("isCover","false"),o.addImage(a,m.id).then(s=>{d(s.data),p(s.data.images.filter(r=>!r.isCover)),i(r=>({...r,open:!0,message:"Image has been added!",severity:"success"}))}).catch(s=>{i(r=>({...r,open:!0,message:"Error Happened while adding image!",severity:"error"}))})},N=(t,a)=>{const s=new FormData;s.append("image",t),s.append("imageId",String(a)),o.uploadImage(s,n.id).then(r=>{d(r.data),p(r.data.images.filter(b=>!b.isCover)),i(b=>({...b,open:!0,message:"Image has been updated!",severity:"success"}))}).catch(r=>{i(b=>({...b,open:!0,message:"Error Happened while uploading image!",severity:"error"}))})},M=t=>{const a=new FormData;a.append("imageId",String(t)),o.deleteImage(a,n.id).then(s=>{d(s.data),p(s.data.images.filter(r=>!r.isCover)),i(r=>({...r,open:!0,message:"Image has been deleted!",severity:"success"}))}).catch(s=>{i(r=>({...r,open:!0,message:"Error Happened while deleting image!",severity:"error"}))})};return P.useEffect(()=>{l.getValues("image")},[l]),e.jsxs(j,{children:[e.jsxs(le,{children:[e.jsxs(K,{href:"/admin/website/get-block/"+n.category,children:["Back to ",n.category]}),e.jsxs(V,{children:["Update ",o.getBlockName(m)]})]}),e.jsx(j,{className:"p-[16px]",children:e.jsxs(V,{variant:"h5",children:["Update ",o.getBlockName(m)]})}),e.jsx(ee,{...l,children:e.jsxs(j,{component:"form",sx:{"& .MuiTextField-root":{m:1,width:"100%"}},noValidate:!0,autoComplete:"off",onSubmit:l.handleSubmit(x),children:[e.jsx(te,{controllerName:"image",methods:l,image:o.getBlockImage(n),onUpload:A}),e.jsx(se,{controlName:"isActive",name:"isActive",id:"isActive",color:"secondary",methods:l,label:"Is Active",sendSwitchState:t=>F(t)}),e.jsx(ae,{methods:l,category:u.toTitleCase(g)}),e.jsxs(me,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,className:"m-[8px]",children:[e.jsx(H,{task:"update",text:u.toTitleCase(g)}),e.jsx(H,{task:"delete",text:u.toTitleCase(g),onClick:y})]})]})}),e.jsx(ce,{}),e.jsx(j,{className:"p-[16px]",children:e.jsxs(V,{variant:"h5",children:["Album for ",o.getBlockName(m)]})}),e.jsx(ue,{images:h,callbackImageUrl:o.getImageUrl,addImage:t=>D(t),updateImage:(t,a)=>N(t,a),deleteImage:t=>M(t),text:"Gallery"}),e.jsx(X,{open:f.open,message:f.message,onClose:v,severity:f.severity}),e.jsx(z,{open:k,onClose:C,message:`Are you sure that you want to delete ${o.getBlockName(m)}`,confirmDelete:E})]})};export{ft as default};
